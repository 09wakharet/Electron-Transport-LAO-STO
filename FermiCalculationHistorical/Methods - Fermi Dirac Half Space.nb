(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     56264,       1514]
NotebookOptionsPosition[     56019,       1501]
NotebookOutlinePosition[     56361,       1516]
CellTagsIndexPosition[     56318,       1513]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Poisson", " ", "solver", " ", "that", " ", "implements", " ", "the", 
      " ", "first", " ", "part", " ", "of", " ", "the", " ", "algorithm", " ",
       "described", " ", "below"}], " ", "-", " ", 
     RowBox[{
     "it", " ", "represents", " ", "the", " ", "Laplacian", " ", "as", " ", 
      "a", " ", "matrix", " ", "operator", " ", "then", " ", "inverts", " ", 
      RowBox[{"it", ".", " ", "Any"}], " ", "solution", " ", "to", " ", 
      RowBox[{"Poisson", "'"}], "s", " ", "equation", " ", "is", " ", "now", 
      " ", "found", " ", "by", " ", "multiplying", " ", "the", " ", "inverse",
       " ", "matrix", " ", "by", " ", "the", " ", 
      RowBox[{"(", 
       RowBox[{"forcing", " ", "function", " ", 
        RowBox[{"\[Rho]", "?", " ", "idk"}], " ", "if", " ", "you", " ", 
        "can", " ", "call", " ", "it", " ", "that"}], ")"}]}]}], "*)"}],
   FontWeight->"Bold"], 
  StyleBox["\[IndentingNewLine]",
   FontWeight->"Bold"], 
  StyleBox[
   RowBox[{"(*", 
    RowBox[{
    "This", " ", "is", " ", "a", " ", "symmetric", " ", "finite", " ", 
     "difference", " ", "method", " ", "to", " ", "solve", " ", "the", " ", 
     "Poisson", " ", "Equation"}], "*)"}],
   FontWeight->"Bold"], 
  StyleBox[" ",
   FontWeight->"Bold"], 
  StyleBox["\[IndentingNewLine]",
   FontWeight->"Bold"], 
  StyleBox[
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"en", ".", "wikipedia", ".", "org"}], "/", "wiki"}], "/", 
      "Discrete_Poisson"}], "_equation"}], "*)"}],
   FontWeight->"Bold"], 
  StyleBox["\[IndentingNewLine]",
   FontWeight->"Bold"], 
  RowBox[{
   RowBox[{
    RowBox[{"PoissonSolver", "[", 
     RowBox[{
     "MM_", ",", "NN_", ",", "chargeList_List", ",", "\[Epsilon]1_", ",", 
      "\[Epsilon]2_", ",", "H_", ",", "a_", ",", "\[Lambda]_"}], " ", "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "m", ",", "m1", ",", "m2", ",", "m3", ",", "m4", ",", "m5", ",", "m6", 
        ",", "m7", ",", "m8", ",", "m9", ",", "newm", 
        StyleBox[",",
         FontWeight->"Bold"], 
        StyleBox["Ry",
         FontWeight->"Bold"], 
        StyleBox[",",
         FontWeight->"Bold"], 
        StyleBox["\[Alpha]",
         FontWeight->"Bold"], 
        StyleBox[",",
         FontWeight->"Bold"], 
        StyleBox["\[Gamma]",
         FontWeight->"Bold"], 
        StyleBox[",",
         FontWeight->"Bold"], "plotList", ",", "totalCharge", ",", 
        "tempTotal", ",", "list", ",", "potential", ",", "exteriorPoints", 
        ",", "chargeVector"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      StyleBox[
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"construct", " ", "D"}], ",", " ", 
         RowBox[{
         "the", " ", "matrix", " ", "operator", " ", "that", " ", 
          "corresponds", " ", "to", " ", "the", " ", 
          RowBox[{"Laplacian", ".", " ", "This"}], " ", "is", " ", "a", " ", 
          "9", " ", "point", " ", 
          RowBox[{"stencil", ".", " ", 
           RowBox[{"It", "'"}]}], "s", " ", "periodic", " ", "with", " ", 
          "respect", " ", "to", " ", "two", " ", 
          RowBox[{"edges", ":", " ", 
           RowBox[{"Born", "-", 
            RowBox[{"von", " ", "Karman", " ", 
             RowBox[{"boundaries", ".", " ", "One"}], " ", "edge", " ", "is", 
             " ", "fixed", " ", "to", " ", "0", " ", "everywhere"}]}], ":", 
           " ", 
           RowBox[{"Dirichlet", " ", 
            RowBox[{"boundaries", ".", " ", "The"}], " ", "last", " ", "edge",
             " ", "has", " ", "the", " ", "normal", " ", "component", " ", 
            "of", " ", "the", " ", "flux", " ", "at", " ", "the", " ", 
            RowBox[{"boundary", ":", " ", 
             RowBox[{"Neumann", " ", 
              RowBox[{"boundaries", "."}]}]}]}]}]}]}], "*)"}],
       FontWeight->"Bold"], 
      StyleBox["\[IndentingNewLine]",
       FontWeight->"Bold"], 
      RowBox[{
       StyleBox[
        RowBox[{
         RowBox[{"periodicblock", "[", 
          RowBox[{"c_", ",", "b_"}], "]"}], ":=", 
         RowBox[{
          RowBox[{"c", " ", 
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"MM", "-", "1"}], "]"}]}], "+", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"b", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "0", ",", 
                RowBox[{"MM", "-", "3"}]}], "}"}]}], "]"}], ",", "1"}], "]"}],
           "+", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"b", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "0", ",", 
                RowBox[{"MM", "-", "3"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"-", "1"}]}], "]"}], "+", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"{", "b", "}"}], ",", 
            RowBox[{
             RowBox[{"-", "MM"}], "+", "2"}]}], "]"}], "+", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"{", "b", "}"}], ",", 
            RowBox[{"MM", "-", "2"}]}], "]"}]}]}],
        FontWeight->"Bold"], 
       StyleBox[";",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       RowBox[{
        StyleBox["m1",
         FontWeight->"Bold"], 
        StyleBox[" ",
         FontWeight->"Bold"], 
        StyleBox["=",
         FontWeight->"Bold"], 
        StyleBox[" ",
         FontWeight->"Bold"], 
        RowBox[{
         StyleBox["periodicblock",
          FontWeight->"Bold"], 
         StyleBox["[",
          FontWeight->"Bold"], 
         RowBox[{
          FractionBox[
           StyleBox[
            RowBox[{"-", "2."}],
            FontWeight->"Bold"], "3"], ",", 
          FractionBox[
           RowBox[{"-", "1"}], "6"]}], 
         StyleBox["]",
          FontWeight->"Bold"]}]}], 
       StyleBox[";",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox[
        RowBox[{"m2", " ", "=", " ", 
         RowBox[{"periodicblock", "[", 
          RowBox[{
           FractionBox[
            StyleBox["10",
             FontWeight->"Bold"], "3"], ",", 
           FractionBox[
            RowBox[{"-", "2"}], "3"]}], "]"}]}],
        FontWeight->"Bold"], 
       StyleBox[";",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox[
        RowBox[{"m3", " ", "=", 
         RowBox[{"KroneckerProduct", "[", 
          RowBox[{
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{"1", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "NN"}], "}"}]}], "]"}], ",", 
               RowBox[{"{", "0", "}"}]}], "]"}], ",", "0"}], "]"}], ",", 
           "m2"}], "]"}]}],
        FontWeight->"Bold"], 
       StyleBox[";",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox[
        RowBox[{"m4", " ", "=", 
         RowBox[{"KroneckerProduct", "[", 
          RowBox[{
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{"1", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"NN", "-", "1"}]}], "}"}]}], "]"}], ",", 
               RowBox[{"{", "0", "}"}]}], "]"}], ",", "1"}], "]"}], ",", 
           "m1"}], "]"}]}],
        FontWeight->"Bold"], 
       StyleBox[";",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox[
        RowBox[{"m5", " ", "=", 
         RowBox[{"KroneckerProduct", "[", 
          RowBox[{
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{"1", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"NN", "-", "1"}]}], "}"}]}], "]"}], ",", 
               RowBox[{"{", "0", "}"}]}], "]"}], ",", 
             RowBox[{"-", "1"}]}], "]"}], ",", "m1"}], "]"}]}],
        FontWeight->"Bold"], 
       StyleBox[";",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       RowBox[{"m6", " ", "=", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"{", "1", "}"}], ",", "NN"}], "]"}], ",", "m1"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"m7", "=", 
        RowBox[{
         FractionBox["1", "2"], 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"MM", "-", "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "The", " ", "matrix", " ", "has", " ", "been", " ", "augmented", " ", 
         "so", " ", "that", " ", "the", " ", "bottom", " ", "blocks", " ", 
         "correspond", " ", "to", " ", "a", " ", "row", " ", "of", " ", 
         "\"\<ghost\>\"", " ", "points", " ", "above", " ", "the", " ", "top",
          " ", 
         RowBox[{"row", ".", " ", "THey"}], " ", "are", " ", "used", " ", 
         "to", " ", "establish", " ", "a", " ", "centered", " ", "second", 
         " ", "order", " ", "approximation", " ", "for", " ", "the", " ", 
         "first", " ", "derivative", " ", "on", " ", "V", " ", "normal", " ", 
         "to", " ", "the", " ", 
         RowBox[{"boundary", ".", " ", "This"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"m8", " ", "=", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}], ",", 
            RowBox[{
             RowBox[{"-", "NN"}], "+", "1"}]}], "]"}], ",", "m7"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"m9", "=", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{"0", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "NN"}], "}"}]}], "]"}], ",", 
              RowBox[{"{", "1", "}"}]}], "]"}], ",", "0"}], "]"}], ",", 
          RowBox[{"-", "m7"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        StyleBox["m",
         FontWeight->"Bold"], 
        StyleBox[" ",
         FontWeight->"Bold"], 
        StyleBox["=",
         FontWeight->"Bold"], 
        StyleBox[" ",
         FontWeight->"Bold"], 
        RowBox[{
         StyleBox["m3",
          FontWeight->"Bold"], "+", "m4", "+", "m5", "+", "m6", "+", "m8", 
         "+", "m9"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"newm", "=", 
        RowBox[{
         StyleBox["m3",
          FontWeight->"Bold"], "+", "m4", "+", "m5"}]}], ";", 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], "\[IndentingNewLine]", 
       RowBox[{
        StyleBox["\[Alpha]",
         FontWeight->"Bold"], 
        StyleBox["=",
         FontWeight->"Bold"], 
        FractionBox[".529", "a"]}], ";", 
       RowBox[{"(*", 
        RowBox[{
         FractionBox[
          SubscriptBox["a", "0"], "a"], ",", " ", 
         RowBox[{"where", " ", 
          SubscriptBox["a", "0"], " ", "is", " ", "the", " ", "Bohr", " ", 
          "radius"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Ry", "=", "13.60569253"}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Rydberg", " ", "unit", " ", "of", " ", "energy"}], ",", " ", 
         RowBox[{
          RowBox[{"in", " ", 
           RowBox[{"eV", ".", " ", "8"}], "\[Pi]Ry"}], "=", 
          RowBox[{
           FractionBox[
            SuperscriptBox["e", "2"], 
            RowBox[{
             SubscriptBox["a", "0"], 
             SubscriptBox["\[Epsilon]", "0"]}]], " ", "in", " ", "eV"}]}]}], 
        "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"totalCharge", "=", " ", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"(", 
           FractionBox[
            StyleBox["\[Epsilon]2",
             FontWeight->"Bold"], "\[Epsilon]1"], 
           StyleBox[")",
            FontWeight->"Bold"]}]}], 
         RowBox[{
          StyleBox["(",
           FontWeight->"Bold"], 
          FractionBox[
           StyleBox["\[Lambda]",
            FontWeight->"Bold"], 
           RowBox[{"N", "[", "\[Pi]", "]"}]], 
          StyleBox[")",
           FontWeight->"Bold"]}], 
         RowBox[{"ArcTan", "[", 
          FractionBox[
           RowBox[{"MM", " ", "a"}], 
           RowBox[{"2", "H"}]], "]"}]}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "analytic", " ", "expression", " ", "for", " ", "the", " ", "total", 
         " ", "charge"}], "*)"}], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], "\[IndentingNewLine]", 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       RowBox[{"tempTotal", "=", 
        RowBox[{
         RowBox[{"Flatten", "[", "chargeList", "]"}], "//", "Total"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "coefficient", " ", "in", " ", "front", " ", "of", " ", "n", " ", 
         "on", " ", "the", " ", "right", " ", "hand", " ", "side", " ", "of", 
         " ", "the", " ", "poisson", " ", "equation"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"\[Gamma]", "=", 
        RowBox[{
         RowBox[{"-", 
          FractionBox[
           RowBox[{"8", 
            RowBox[{"N", "[", "\[Pi]", "]"}], "Ry", " ", "\[Alpha]"}], 
           "\[Epsilon]2"]}], 
         FractionBox["totalCharge", "tempTotal"]}]}], ";", 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       RowBox[{
        StyleBox[
         RowBox[{"e1", "[", "j_", "]"}],
         FontWeight->"Bold"], 
        StyleBox[":=",
         FontWeight->"Bold"], 
        FractionBox[
         RowBox[{"8", 
          RowBox[{"N", "[", "\[Pi]", "]"}], "Ry", " ", "\[Alpha]", " ", 
          "\[Lambda]", " ", "H", " ", "a"}], 
         RowBox[{"2", " ", 
          RowBox[{"N", "[", "\[Pi]", "]"}], "\[Epsilon]1", " ", 
          RowBox[{"(", 
           RowBox[{
            SuperscriptBox["H", "2"], "+", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"j", "-", 
                RowBox[{"Floor", "[", 
                 FractionBox[
                  RowBox[{"MM", "+", "1"}], "2"], "]"}]}], ")"}], "2"], 
             SuperscriptBox["a", "2"]}]}], ")"}]}]]}], ";", 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{
         "Normal", " ", "component", " ", "of", " ", "electric", " ", "field",
           " ", "at", " ", "top", " ", "edge", " ", "of", " ", "the", " ", 
          "grid"}], "*)"}],
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Defines", " ", "the", " ", "list", " ", "with", " ", "the", " ", 
           "charge", " ", "distribution", " ", 
           SubscriptBox[
            StyleBox["\[Rho]",
             FontWeight->"Bold"], "ij"], " ", "generated", " ", "from", " ", 
           "the", " ", "user"}], ",", " ", 
          RowBox[{
          "augmented", " ", "with", " ", "the", " ", "boundary", " ", 
           "conditions"}]}], " ", "*)"}],
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       RowBox[{
        StyleBox["chargeVector",
         FontWeight->"Bold"], 
        StyleBox["  ",
         FontWeight->"Bold"], 
        StyleBox["=",
         FontWeight->"Bold"], 
        StyleBox[" ",
         FontWeight->"Bold"], 
        RowBox[{
         StyleBox["\[Gamma]",
          FontWeight->"Bold"], 
         StyleBox[" ",
          FontWeight->"Bold"], "chargeList"}]}], 
       StyleBox[";",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       RowBox[{"exteriorPoints", 
        StyleBox[" ",
         FontWeight->"Bold"], 
        StyleBox["=",
         FontWeight->"Bold"], 
        StyleBox[" ",
         FontWeight->"Bold"], 
        StyleBox["\[IndentingNewLine]",
         FontWeight->"Bold"], 
        RowBox[{
         StyleBox[
          RowBox[{"Table", "[", "\[IndentingNewLine]", "  ", 
           RowBox[{
            RowBox[{"N", "[", 
             RowBox[{"e1", "[", "j", " ", "]"}], "]"}], " ", ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"MM", "-", "1"}]}], "}"}]}], "\[IndentingNewLine]", 
           "]"}],
          FontWeight->"Bold"], 
         StyleBox["//",
          FontWeight->"Bold"], "Flatten"}]}], 
       StyleBox[";",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       RowBox[{"chargeVector", " ", "=", " ", 
        RowBox[{"Join", "[", 
         RowBox[{"chargeVector", ",", " ", "exteriorPoints"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"chargeVector", "=", 
        RowBox[{"chargeVector", "-", 
         RowBox[{
          FractionBox["1", "2"], 
          RowBox[{"newm", ".", "chargeVector"}]}]}]}], ";", 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{"Calculates", " ", "the", " ", "potential"}], "*)"}],
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox[
        RowBox[{"potential", " ", "=", " ", 
         RowBox[{"LinearSolve", "[", 
          RowBox[{"m", ",", "chargeVector"}], "]"}]}],
        FontWeight->"Bold"], 
       StyleBox[";",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{
         "Reindexes", " ", "the", " ", "potential", " ", "and", " ", 
          "outputs", " ", "a", " ", "list", " ", "of", " ", "voltage", " ", 
          "formatted", " ", "as", " ", 
          RowBox[{"{", 
           RowBox[{"x", ",", "y", ",", 
            RowBox[{"V", 
             RowBox[{"(", 
              RowBox[{"x", ",", "y"}], ")"}]}]}], "}"}]}], "*)"}],
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       StyleBox[
        RowBox[{"list", "=", 
         RowBox[{"{", "}"}]}],
        FontWeight->"Bold"], 
       StyleBox[";",
        FontWeight->"Bold"], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold"], 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"list", ",", "\[IndentingNewLine]", 
            RowBox[{
             StyleBox["Table",
              FontWeight->"Bold"], 
             StyleBox["[",
              FontWeight->"Bold"], 
             StyleBox["\[IndentingNewLine]",
              FontWeight->"Bold"], 
             RowBox[{
              RowBox[{"potential", "[", 
               RowBox[{"[", 
                RowBox[{"j", " ", "+", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"MM", "-", "1"}], ")"}], 
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}], 
              StyleBox[",",
               FontWeight->"Bold"], 
              StyleBox["\[IndentingNewLine]",
               FontWeight->"Bold"], 
              StyleBox[
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", 
                 RowBox[{"MM", "-", "1"}]}], "}"}],
               FontWeight->"Bold"]}], 
             StyleBox["\[IndentingNewLine]",
              FontWeight->"Bold"], 
             StyleBox["]",
              FontWeight->"Bold"]}]}], 
           StyleBox["\[IndentingNewLine]",
            FontWeight->"Bold"], 
           StyleBox["]",
            FontWeight->"Bold"]}], 
          StyleBox[";",
           FontWeight->"Bold"], 
          StyleBox["\[IndentingNewLine]",
           FontWeight->"Bold"], 
          RowBox[{"AppendTo", "[", 
           RowBox[{"list", ",", 
            RowBox[{"potential", "[", 
             RowBox[{"[", 
              RowBox[{"1", " ", "+", " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"MM", "-", "1"}], ")"}], 
                RowBox[{"(", 
                 RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"list", "=", 
           RowBox[{"list", "//", "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "NN"}], "}"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          StyleBox["Table",
           FontWeight->"Bold"], 
          StyleBox["[",
           FontWeight->"Bold"], 
          StyleBox["\[IndentingNewLine]",
           FontWeight->"Bold"], 
          RowBox[{
           RowBox[{
            StyleBox["{",
             FontWeight->"Bold"], 
            RowBox[{
             StyleBox["i",
              FontWeight->"Bold"], 
             StyleBox[",",
              FontWeight->"Bold"], 
             StyleBox["j",
              FontWeight->"Bold"], 
             StyleBox[",",
              FontWeight->"Bold"], 
             RowBox[{"list", "[", 
              RowBox[{"[", 
               RowBox[{"j", " ", "+", " ", 
                RowBox[{
                 RowBox[{"(", "MM", ")"}], 
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}]}], "}"}], 
           StyleBox[",",
            FontWeight->"Bold"], 
           StyleBox["\[IndentingNewLine]",
            FontWeight->"Bold"], 
           StyleBox[
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "NN"}], "}"}],
            FontWeight->"Bold"], 
           StyleBox[",",
            FontWeight->"Bold"], 
           StyleBox["\[IndentingNewLine]",
            FontWeight->"Bold"], 
           StyleBox[
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", "MM"}], "}"}],
            FontWeight->"Bold"]}], 
          StyleBox["\[IndentingNewLine]",
           FontWeight->"Bold"], 
          StyleBox["]",
           FontWeight->"Bold"]}], 
         StyleBox[",",
          FontWeight->"Bold"], 
         StyleBox["1",
          FontWeight->"Bold"]}], 
        StyleBox["]",
         FontWeight->"Bold"]}]}]}], 
     StyleBox["\[IndentingNewLine]",
      FontWeight->"Bold"], 
     StyleBox["]",
      FontWeight->"Bold"]}]}], 
   StyleBox["\[IndentingNewLine]",
    FontWeight->"Bold"], 
   RowBox[{
    StyleBox[
     RowBox[{"PoissonPlot", "[", 
      RowBox[{
      "MM_", ",", "NN_", ",", "chargeList_List", ",", "\[Epsilon]1_", ",", 
       "\[Epsilon]2_", ",", "H_", ",", "a_", ",", "\[Lambda]_"}], " ", "]"}],
     FontWeight->"Bold"], 
    StyleBox[":=",
     FontWeight->"Bold"], 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"plotList", "=", 
        RowBox[{"PoissonSolver", "[", 
         RowBox[{
         "MM", ",", "NN", ",", "chargeList", ",", "\[Epsilon]1", ",", 
          "\[Epsilon]2", ",", "H", ",", "a", ",", "\[Lambda]"}], " ", "]"}]}],
        "}"}], ",", "\[IndentingNewLine]", 
      StyleBox[
       RowBox[{"ListPlot3D", "[", 
        RowBox[{"plotList", ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{
         "PlotLabel", "\[Rule]", "\"\<Calculated Electric Potential\>\""}], 
         ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}],
       FontWeight->"Bold"]}], 
     StyleBox["\[IndentingNewLine]",
      FontWeight->"Bold"], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"HalfSpaceVoltage", 
     StyleBox["[",
      FontWeight->"Bold"], 
     StyleBox[
      RowBox[{
      "MM_", ",", "NN_", ",", "chargeList_List", ",", "\[Epsilon]1_", ",", 
       "\[Epsilon]2_", ",", "H_", ",", "a_", ",", "\[Lambda]_"}],
      FontWeight->"Bold"], 
     StyleBox[" ",
      FontWeight->"Bold"], 
     StyleBox["]",
      FontWeight->"Bold"]}], 
    StyleBox[":=",
     FontWeight->"Bold"], 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"list", "=", 
         RowBox[{
          RowBox[{"PoissonSolver", "[", 
           RowBox[{
           "MM", ",", "NN", ",", "chargeList", ",", "\[Epsilon]1", ",", 
            "\[Epsilon]2", ",", "H", ",", "a", ",", "\[Lambda]"}], " ", "]"}],
           "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ",", "table"}], "}"}], 
      ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      StyleBox[
       RowBox[{
        RowBox[{"table", "=", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"list", "[", 
             RowBox[{"[", 
              RowBox[{"j", " ", "+", " ", 
               RowBox[{"MM", 
                RowBox[{"(", 
                 RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "NN"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              StyleBox["j",
               FontWeight->"Bold"], 
              StyleBox[",",
               FontWeight->"Bold"], 
              RowBox[{"Floor", "[", 
               FractionBox[
                StyleBox[
                 RowBox[{"MM", "+", "1"}],
                 FontWeight->"Bold"], "2"], "]"}], ",", "MM"}], "}"}]}], 
           "\[IndentingNewLine]", "]"}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"halfspacelist", "=", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"table", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"table", "//", "Length"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], 
           "\[IndentingNewLine]", "]"}], "//", "Flatten"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "halfspacelist"}],
       FontWeight->"Bold"]}], 
     StyleBox["\[IndentingNewLine]",
      FontWeight->"Bold"], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BaseMatrixTakesChargeList", "[", 
     RowBox[{
     "MM_", ",", "NN_", ",", "chargeList_List", ",", "\[Epsilon]1_", ",", 
      "\[Epsilon]2_", ",", "H_", ",", "a_", ",", "\[Lambda]_", ",", "t1_", 
      ",", "t2_"}], " ", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"list", "=", 
         RowBox[{"HalfSpaceVoltage", "[", 
          RowBox[{
          "MM", ",", "NN", ",", "chargeList", ",", "\[Epsilon]1", ",", 
           "\[Epsilon]2", ",", "H", ",", "a", ",", "\[Lambda]"}], " ", 
          "]"}]}], ",", "voltageMatrix", ",", "tx", ",", "ty", ",", "m1", ",",
         "m2", ",", "m3", ",", "m4", ",", 
        RowBox[{"mm", "=", 
         RowBox[{"Floor", "[", 
          FractionBox[
           RowBox[{"MM", "+", "1"}], "2"], "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"voltageMatrix", "=", 
        RowBox[{"DiagonalMatrix", "[", 
         StyleBox["list",
          FontWeight->"Bold"], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tx", " ", "=", " ", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"t2", ",", "t1", ",", "t1"}], "}"}], ",", "0"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"ty", " ", "=", " ", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"t1", ",", "t2", ",", "t1"}], "}"}], ",", "0"}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "These", " ", "4", " ", "matrices", " ", "are", " ", "interatomic", 
          " ", "bonding", " ", "in", " ", "each", " ", "of", " ", "the", " ", 
          "4", " ", "directions", " ", "in", " ", "the", " ", "x"}], "-", 
         RowBox[{"y", " ", "plane"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"m1", " ", "=", " ", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"NN", "*", "mm"}], "-", "1"}], "}"}]}], "]"}], ",", 
            "1"}], "]"}], ",", "ty"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"m2", " ", "=", " ", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"NN", "*", "mm"}], "-", "1"}], "}"}]}], "]"}], ",", 
            RowBox[{"-", "1"}]}], "]"}], ",", "ty"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m3", " ", "=", " ", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"NN", "*", "mm"}], "-", "mm"}], "}"}]}], "]"}], ",", 
            "mm"}], "]"}], ",", "tx"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"m4", " ", "=", " ", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"NN", "*", "mm"}], "-", "mm"}], "}"}]}], "]"}], ",", 
            RowBox[{"-", "mm"}]}], "]"}], ",", "tx"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
       "m1", "+", "m2", "+", "m3", "+", "m4", "+", "voltageMatrix"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   StyleBox[
    RowBox[{"(*", 
     RowBox[{
     "Returns", " ", "sorted", " ", "eigensystem", " ", "for", " ", "matrix", 
      " ", "parametrized", " ", "by", " ", "kz"}], "*)"}],
    FontWeight->"Bold"], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     StyleBox[
      RowBox[{"eigensystem", "[", "kz_", "]"}],
      FontWeight->"Bold"], 
     StyleBox[":=",
      FontWeight->"Bold"], 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "Eyz", ",", "Ezx", ",", "Exy", ",", " ", "hamiltonian", ",", "m1", 
         ",", "vals", ",", "vecs"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Eyz", " ", "=", " ", 
         RowBox[{
          RowBox[{"2", "t1"}], " ", "-", 
          RowBox[{"2", " ", "t1", " ", 
           RowBox[{"Cos", "[", "kz", "]"}]}], "+", 
          RowBox[{"2", "t2"}], "+", 
          RowBox[{"2", "t1"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Ezx", " ", "=", " ", 
         RowBox[{
          RowBox[{"2", "t1"}], " ", "-", 
          RowBox[{"2", " ", "t1", " ", 
           RowBox[{"Cos", "[", "kz", "]"}]}], "+", 
          RowBox[{"2", "t1"}], "+", 
          RowBox[{"2", "t2"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Exy", " ", "=", " ", 
         RowBox[{
          RowBox[{"2", "t2"}], " ", "-", 
          RowBox[{"2", " ", "t2", " ", 
           RowBox[{"Cos", "[", "kz", "]"}]}], "+", 
          RowBox[{"2", "t1"}], "+", 
          RowBox[{"2", "t1"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"hamiltonian", "  ", "=", " ", 
         RowBox[{"DiagonalMatrix", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Eyz", ",", "Ezx", ",", "Exy"}], "}"}], ",", "0"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"m1", " ", "=", " ", 
         RowBox[{"KroneckerProduct", "[", 
          RowBox[{
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"NN", "*", "mm"}], "]"}], ",", "hamiltonian"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"matrix", "=", 
         RowBox[{"baseMatrix", "+", "m1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"vals", ",", "vecs"}], "}"}], "=", 
         RowBox[{"Eigensystem", "[", "matrix", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vecs", "=", 
         RowBox[{"vecs", "[", 
          RowBox[{"[", 
           RowBox[{"Ordering", "[", "vals", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vals", "=", 
         RowBox[{"Sort", "[", "vals", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"vals", ",", "vecs"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"\[Alpha]", "=", 
      RowBox[{"1", " ", "for", " ", "yz"}]}], ",", " ", 
     RowBox[{"2", " ", "for", " ", "zx"}], ",", " ", 
     RowBox[{"3", " ", "for", " ", "xy"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"orbitalDensity", "[", 
      RowBox[{"n_", ",", "\[Alpha]_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"list", "=", 
         RowBox[{
          RowBox[{"vecs", "[", 
           RowBox[{"[", "n", "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"\[Alpha]", ";;", ";;", "3"}], "]"}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          StyleBox["Table",
           FontWeight->"Bold"], 
          StyleBox["[",
           FontWeight->"Bold"], 
          StyleBox["\[IndentingNewLine]",
           FontWeight->"Bold"], 
          RowBox[{
           RowBox[{
            StyleBox["{",
             FontWeight->"Bold"], 
            RowBox[{
             StyleBox["i",
              FontWeight->"Bold"], 
             StyleBox[" ",
              FontWeight->"Bold"], 
             StyleBox[",",
              FontWeight->"Bold"], 
             StyleBox["j",
              FontWeight->"Bold"], 
             StyleBox[" ",
              FontWeight->"Bold"], 
             StyleBox[",",
              FontWeight->"Bold"], 
             RowBox[{
              RowBox[{"latticeDegeneracy", "[", 
               RowBox[{"i", ",", "j"}], "]"}], 
              SuperscriptBox[
               RowBox[{"Norm", "[", 
                RowBox[{"list", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", " ", "+", " ", 
                   RowBox[{"mm", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}], "]"}], 
               "2"]}]}], 
            StyleBox["}",
             FontWeight->"Bold"]}], 
           StyleBox[",",
            FontWeight->"Bold"], 
           StyleBox["\[IndentingNewLine]",
            FontWeight->"Bold"], 
           StyleBox[
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "NN"}], "}"}],
            FontWeight->"Bold"], 
           StyleBox[",",
            FontWeight->"Bold"], 
           StyleBox["\[IndentingNewLine]",
            FontWeight->"Bold"], 
           StyleBox[
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", "mm"}], "}"}],
            FontWeight->"Bold"]}], 
          StyleBox["\[IndentingNewLine]",
           FontWeight->"Bold"], 
          StyleBox["]",
           FontWeight->"Bold"]}], 
         StyleBox[",",
          FontWeight->"Bold"], 
         StyleBox["1",
          FontWeight->"Bold"]}], 
        StyleBox["]",
         FontWeight->"Bold"]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"totalDensity", "[", "n_", "]"}], ":=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"orbitalDensity", "[", 
         RowBox[{"n", ",", "1"}], "]"}], "+", 
        RowBox[{"orbitalDensity", "[", 
         RowBox[{"n", ",", "2"}], "]"}], "+", 
        RowBox[{"orbitalDensity", "[", 
         RowBox[{"n", ",", "3"}], "]"}]}], ")"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"totalDensityPlot", "[", "n_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"list", "=", 
         RowBox[{"totalDensity", "[", "n", "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ListPlot3D", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            StyleBox["Table",
             FontWeight->"Bold"], 
            StyleBox["[",
             FontWeight->"Bold"], 
            StyleBox["\[IndentingNewLine]",
             FontWeight->"Bold"], 
            RowBox[{
             RowBox[{
              StyleBox["{",
               FontWeight->"Bold"], 
              RowBox[{
               StyleBox["i",
                FontWeight->"Bold"], 
               StyleBox[" ",
                FontWeight->"Bold"], 
               StyleBox[",",
                FontWeight->"Bold"], 
               StyleBox["j",
                FontWeight->"Bold"], 
               StyleBox[" ",
                FontWeight->"Bold"], 
               StyleBox[",",
                FontWeight->"Bold"], 
               RowBox[{"list", "[", 
                RowBox[{"[", 
                 RowBox[{"j", " ", "+", " ", 
                  RowBox[{"mm", 
                   RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}]}], 
              StyleBox["}",
               FontWeight->"Bold"]}], 
             StyleBox[",",
              FontWeight->"Bold"], 
             StyleBox["\[IndentingNewLine]",
              FontWeight->"Bold"], 
             StyleBox[
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "NN"}], "}"}],
              FontWeight->"Bold"], 
             StyleBox[",",
              FontWeight->"Bold"], 
             StyleBox["\[IndentingNewLine]",
              FontWeight->"Bold"], 
             StyleBox[
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", "mm"}], "}"}],
              FontWeight->"Bold"]}], 
            StyleBox["\[IndentingNewLine]",
             FontWeight->"Bold"], 
            StyleBox["]",
             FontWeight->"Bold"]}], 
           StyleBox[",",
            FontWeight->"Bold"], 
           StyleBox["1",
            FontWeight->"Bold"]}], 
          StyleBox["]",
           FontWeight->"Bold"]}], 
         StyleBox[",",
          FontWeight->"Bold"], 
         RowBox[{
          StyleBox["PlotRange",
           FontWeight->"Bold"], 
          StyleBox["\[Rule]",
           FontWeight->"Bold"], "All"}]}], 
        StyleBox["]",
         FontWeight->"Bold"]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"spinKDegeneracyFactor", "[", "kz_", "]"}], ":=", 
     RowBox[{"2", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"kz", "\[Equal]", "0"}], " ", "||", 
         RowBox[{"kz", "\[Equal]", 
          RowBox[{"N", "[", "Pi", "]"}]}]}], ",", "1", ",", "2"}], "]"}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"latticeDegeneracy", "[", 
      RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"j", "\[Equal]", "1"}], " ", "||", 
        RowBox[{"j", "\[Equal]", "mm"}]}], ",", "1", ",", "2"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fermiFactor", "[", 
      RowBox[{"n_", ",", "T_", ",", "\[Mu]_", ",", "kz_"}], "]"}], ":=", 
     FractionBox[
      RowBox[{"spinKDegeneracyFactor", "[", "kz", "]"}], 
      RowBox[{
       RowBox[{"Exp", "[", 
        RowBox[{
         FractionBox["11604.5", "T"], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"vals", "[", 
            RowBox[{"[", "n", "]"}], "]"}], "-", "\[Mu]"}], ")"}]}], "]"}], 
       "+", "1"}]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateDensity", "[", 
      RowBox[{"kz_", ",", "\[Mu]_"}], "]"}], ":=", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"totalDensity", "[", "n", "]"}], 
        RowBox[{"fermiFactor", "[", 
         RowBox[{"n", ",", "temp", ",", "\[Mu]", ",", "kz"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "1", ",", 
         RowBox[{"Length", "[", "vals", "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateDensityPlot", "[", 
      RowBox[{"kz_", ",", "\[Mu]_"}], "]"}], ":=", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"list", "=", 
         RowBox[{"stateDensity", "[", 
          RowBox[{"kz", ",", "\[Mu]"}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ListPlot3D", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i", " ", ",", "j", " ", ",", 
               RowBox[{"list", "[", 
                RowBox[{"[", 
                 RowBox[{"j", " ", "+", " ", 
                  RowBox[{"mm", 
                   RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}]}], 
              StyleBox["}",
               FontWeight->"Bold"]}], 
             StyleBox[",",
              FontWeight->"Bold"], 
             StyleBox["\[IndentingNewLine]",
              FontWeight->"Bold"], 
             StyleBox[
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "NN"}], "}"}],
              FontWeight->"Bold"], 
             StyleBox[",",
              FontWeight->"Bold"], 
             StyleBox["\[IndentingNewLine]",
              FontWeight->"Bold"], 
             StyleBox[
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", "mm"}], "}"}],
              FontWeight->"Bold"]}], 
            StyleBox["\[IndentingNewLine]",
             FontWeight->"Bold"], 
            StyleBox["]",
             FontWeight->"Bold"]}], 
           StyleBox[",",
            FontWeight->"Bold"], 
           StyleBox["1",
            FontWeight->"Bold"]}], 
          StyleBox["]",
           FontWeight->"Bold"]}], "\[IndentingNewLine]", ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"normalizedSumList", "[", "\[Mu]_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "totalList", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"vals", ",", "vecs"}], "}"}], "=", 
         RowBox[{"eigensystem", "[", "0", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"vals", "=", 
         RowBox[{"vals", "-", "initShift"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"totalList", "=", 
         RowBox[{"stateDensity", "[", 
          RowBox[{"0", " ", ",", "\[Mu]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"SetSharedVariable", "[", "totalList", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ParallelDo", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"vals", ",", "vecs"}], "}"}], "=", 
            RowBox[{"eigensystem", "[", 
             RowBox[{"i", " ", "dk"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"vals", "=", 
            RowBox[{"vals", "-", "initShift"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"totalList", "+=", 
            RowBox[{"stateDensity", "[", 
             RowBox[{
              RowBox[{"i", " ", "dk"}], " ", ",", "\[Mu]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"vals", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ">", 
              RowBox[{"\[Mu]", "+", 
               RowBox[{"3", " ", "temp", " ", "8.61733", 
                RowBox[{"(", 
                 SuperscriptBox["10", 
                  RowBox[{"-", "5"}]], ")"}]}]}]}], ",", "Break"}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "numPartitions"}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"totalList", "=", 
         FractionBox["totalList", 
          RowBox[{"2", " ", "numPartitions"}]]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"normalizedSum", "[", "\[Mu]_", "]"}], ":=", 
     RowBox[{
      RowBox[{"normalizedSumList", "[", "\[Mu]", "]"}], "//", "Total"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"normalizedSumPlot", "[", "\[Mu]_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"list", "=", 
         RowBox[{"normalizedSumList", "[", "\[Mu]", "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ListPlot3D", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i", " ", ",", "j", " ", ",", 
               RowBox[{"list", "[", 
                RowBox[{"[", 
                 RowBox[{"j", " ", "+", " ", 
                  RowBox[{"mm", 
                   RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}]}], 
              StyleBox["}",
               FontWeight->"Bold"]}], 
             StyleBox[",",
              FontWeight->"Bold"], 
             StyleBox["\[IndentingNewLine]",
              FontWeight->"Bold"], 
             StyleBox[
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "NN"}], "}"}],
              FontWeight->"Bold"], 
             StyleBox[",",
              FontWeight->"Bold"], 
             StyleBox["\[IndentingNewLine]",
              FontWeight->"Bold"], 
             StyleBox[
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", "mm"}], "}"}],
              FontWeight->"Bold"]}], 
            StyleBox["\[IndentingNewLine]",
             FontWeight->"Bold"], 
            StyleBox["]",
             FontWeight->"Bold"]}], 
           StyleBox[",",
            FontWeight->"Bold"], 
           StyleBox["1",
            FontWeight->"Bold"]}], 
          StyleBox["]",
           FontWeight->"Bold"]}], "\[IndentingNewLine]", ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HalfToFullSpaceWhileHalving", "[", "halfSpaceVals_List", "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"listvals", "=", 
         RowBox[{"{", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"listvals", ",", 
             RowBox[{"halfSpaceVals", "[", 
              RowBox[{"[", 
               RowBox[{"mm", " ", "+", " ", 
                RowBox[{
                 RowBox[{"(", "mm", ")"}], 
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"listvals", ",", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               FractionBox[
                RowBox[{"halfSpaceVals", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", " ", "+", " ", 
                   RowBox[{
                    RowBox[{"(", "mm", ")"}], 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}], "2"], 
               StyleBox[",",
                FontWeight->"Bold"], 
               StyleBox["\[IndentingNewLine]",
                FontWeight->"Bold"], 
               RowBox[{
                StyleBox["{",
                 FontWeight->"Bold"], 
                RowBox[{
                 StyleBox["j",
                  FontWeight->"Bold"], 
                 StyleBox[",",
                  FontWeight->"Bold"], 
                 RowBox[{"mm", "-", "1"}], ",", "2", ",", 
                 RowBox[{"-", "1"}]}], 
                StyleBox["}",
                 FontWeight->"Bold"]}]}], 
              StyleBox["\[IndentingNewLine]",
               FontWeight->"Bold"], 
              StyleBox["]",
               FontWeight->"Bold"]}]}], 
            StyleBox["]",
             FontWeight->"Bold"]}], 
           StyleBox[";",
            FontWeight->"Bold"], 
           StyleBox["\[IndentingNewLine]",
            FontWeight->"Bold"], 
           RowBox[{"AppendTo", "[", 
            RowBox[{"listvals", ",", 
             RowBox[{"halfSpaceVals", "[", 
              RowBox[{"[", 
               RowBox[{"1", " ", "+", " ", 
                RowBox[{
                 RowBox[{"(", "mm", ")"}], 
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"listvals", ",", 
             RowBox[{
              StyleBox["Table",
               FontWeight->"Bold"], 
              StyleBox["[",
               FontWeight->"Bold"], 
              StyleBox["\[IndentingNewLine]",
               FontWeight->"Bold"], 
              RowBox[{
               FractionBox[
                RowBox[{"halfSpaceVals", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", " ", "+", " ", 
                   RowBox[{
                    RowBox[{"(", "mm", ")"}], 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}], "2"], 
               StyleBox[",",
                FontWeight->"Bold"], 
               StyleBox["\[IndentingNewLine]",
                FontWeight->"Bold"], 
               RowBox[{
                StyleBox["{",
                 FontWeight->"Bold"], 
                RowBox[{
                 StyleBox["j",
                  FontWeight->"Bold"], 
                 StyleBox[",",
                  FontWeight->"Bold"], 
                 StyleBox["2",
                  FontWeight->"Bold"], 
                 StyleBox[",",
                  FontWeight->"Bold"], 
                 RowBox[{"mm", "-", "1"}], ",", "1"}], 
                StyleBox["}",
                 FontWeight->"Bold"]}]}], 
              StyleBox["]",
               FontWeight->"Bold"]}]}], 
            StyleBox["\[IndentingNewLine]",
             FontWeight->"Bold"], 
            StyleBox["]",
             FontWeight->"Bold"]}], 
           StyleBox[";",
            FontWeight->"Bold"]}], 
          StyleBox["\[IndentingNewLine]",
           FontWeight->"Bold"], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "NN"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"listvals", "=", 
         RowBox[{"Flatten", "[", "listvals", "]"}]}], ";", 
        "\[IndentingNewLine]", "listvals"}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}]}]}]], "Input",
 CellChangeTimes->{{3.6500388337567434`*^9, 3.650038957291216*^9}, {
   3.6500390591552553`*^9, 3.6500390622953176`*^9}, {3.650043127860318*^9, 
   3.6500431570409017`*^9}, {3.6500438019948006`*^9, 3.650043834415449*^9}, {
   3.6500438966166925`*^9, 3.650043906226885*^9}, {3.650044144038096*^9, 
   3.650044160948434*^9}, {3.6500442179115753`*^9, 3.6500443326318827`*^9}, {
   3.6500444097954283`*^9, 3.6500444109264507`*^9}, {3.6500444529992943`*^9, 
   3.650044464959533*^9}, {3.6500445424730854`*^9, 3.650044545753151*^9}, {
   3.6501242234883633`*^9, 3.650124313860902*^9}, {3.6501244328765907`*^9, 
   3.650124434998231*^9}, {3.650124472735357*^9, 3.6501247247714224`*^9}, {
   3.650125214147344*^9, 3.65012531846655*^9}, {3.650125672420274*^9, 
   3.6501257085349684`*^9}, {3.6501259678119545`*^9, 3.650125993770854*^9}, {
   3.650126062068967*^9, 3.650126081413339*^9}, {3.6501262970874867`*^9, 
   3.650126373388554*^9}, {3.650126417131795*^9, 3.6501264203142567`*^9}, {
   3.6501265245086603`*^9, 3.650126648390642*^9}, {3.650127543376655*^9, 
   3.6501275763244886`*^9}, {3.6501297710042987`*^9, 
   3.6501298199892406`*^9}, {3.650130229247511*^9, 3.6501302477806673`*^9}, 
   3.650130561990012*^9, 3.650130693634165*^9, 3.6501319127901907`*^9, 
   3.650133978142885*^9, {3.6501349113581977`*^9, 3.650134915212583*^9}, {
   3.650297045609443*^9, 3.6502970478402863`*^9}, 3.6502976864707675`*^9, {
   3.65072871853448*^9, 3.6507287209993277`*^9}, {3.6507290058206067`*^9, 
   3.6507290114679155`*^9}, 3.6507401810458584`*^9, {3.650814275682824*^9, 
   3.6508142835453753`*^9}, {3.6508166982154217`*^9, 3.6508167027239084`*^9}, 
   3.650816737945787*^9, {3.650816936606408*^9, 3.6508169798192387`*^9}, {
   3.65081721128189*^9, 3.650817237006785*^9}, 3.650817301997635*^9, {
   3.6508192039592237`*^9, 3.6508192155502467`*^9}, {3.6508192698392906`*^9, 
   3.6508192701668973`*^9}, {3.6508198422701883`*^9, 3.6508198690559034`*^9}, 
   3.650819916558817*^9, {3.6508222623752785`*^9, 3.650822273513892*^9}, 
   3.650822316757924*^9, {3.6512368080401497`*^9, 3.6512368088272285`*^9}, {
   3.651239827784392*^9, 3.651239827971618*^9}, {3.651242913497797*^9, 
   3.651242984801797*^9}, {3.651243022811797*^9, 3.6512430349067974`*^9}, {
   3.651243122640797*^9, 3.651243124534797*^9}, 3.6512431871897974`*^9, {
   3.6512434038259535`*^9, 3.6512434084214125`*^9}, {3.651243687871355*^9, 
   3.6512436885234203`*^9}}]
},
WindowSize->{624, 946},
WindowMargins->{{Automatic, 0}, {0, Automatic}},
FrontEndVersion->"9.0 for Microsoft Windows (64-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 55458, 1479, 5238, "Input"]
}
]
*)

(* End of internal cache information *)
